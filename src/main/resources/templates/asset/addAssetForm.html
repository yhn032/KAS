<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/header :: header">
    <meta charset="UTF-8">
    <title>물품 등록 폼</title>
</head>
<body>
  <div th:replace="layout/navBar :: navBar"></div>
  <div th:replace="layout/sidebar :: sidebar"></div>
  <div class="content-main">
    <button class="content-toggle-btn" onclick="toggleSidebar()">◀</button>
    <form id="assetForm" enctype="multipart/form-data" style="margin-top: 50px; display: flex; flex-direction: row; width: 100vw; justify-content: center">
        <div class="form-left" style="width: 30%; margin-left: 20%;">
            <label for="assetName">물품명</label><br>
            <input id="assetName" type="text" name="assetName" value=""><br>
            <label for="assetCtg">물품 카테고리</label><br>
            <input id="assetCtg" type="text" name="assetCtg" value=""><br>
            <label for="assetCnt">물품 수량</label><br>
            <input id="assetCnt" type="text" name="assetCnt" value=""><br>
            <label for="assetCnt">물품 위치</label><br>
            <input id="assetPos" type="text" name="assetPos" value=""><br>
            <label for="regTeacherName">등록자:</label><br>
            <select id="regTeacherName" name="regTeacherName">
                <option th:each="name : ${teacherNames}" th:value="${name}" th:text="${name}"></option>
            </select><br>
        </div>
        <div class="form-right" style="width: 50%;">
            <label for="assetImgFile">자산 사진</label><br>
            <input type="file" name="assetImgFile" id="assetImgFile" accept=".jpg, .png" class="form-control"><br>
            <img id="assetImg" width="300px" height="300px" src="/img/uploads/profile/default.png">
            <button type="button" onclick="addAsset()">등록</button>
        </div>
    </form>
  </div>
  <script>
      const fileInput = document.getElementById("assetImgFile");
      $('#assetImgFile').change(function(){
        let upload_photo = this.files[0];

        let reader = new FileReader();
        reader.readAsDataURL(upload_photo);

        reader.onload = function(){
            $("#assetImg").attr("src", reader.result);
        };

      });

      function addAsset(){
          //FormData 객체를 사용하여 form 데이터 수집
          const formData = new FormData(document.getElementById("assetForm"));
          const fileInput = document.getElementById("assetImgFile");
          if(fileInput.files.length > 0) {
              formData.append("assetImgFile", fileInput.files[0]);
          }

          const data = {
            info: {
                assetName : $("#assetName").val(),
                assetTotalCnt : $("#assetCnt").val(),
                assetRemainCnt : $("#assetCnt").val(),
                assetPos : $("#assetPos").val(),
                assetCtg : $("#assetCtg").val(),
                regTeacherName : $("#regTeacherName").val()
            }
          };

          formData.append("assetDto", new Blob([JSON.stringify(data.info)], {type : "application/json"}));
          console.log(formData);

          $.ajax({
              type : 'POST',
              url : '/asset/addList',
              data : formData,
              processData: false,
              contentType: false,
              success: function (data) {

                  console.log('파일 업로드 성공');
                  console.log(data);
                  location.href = '/asset/allList';
              },
              error:function (jqXHR, textStatus, errorThrown) {
                  console.log("Request Failed");
                  console.log('jqXHR : ', jqXHR);
                  console.log('textStatus : ', textStatus);
                  console.log('errorThrown : ', errorThrown);
              }
          })
      }
  </script>
  <div th:replace="layout/footer :: footer"></div>
</body>
</html>